<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="../css/personal_info.css">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3177205_zo49idqeoes.css">
    <script type="text/javascript" src="../js/flexible.js"></script>
    <script src="../js/vue.js"></script>
    <script src="../js/axios.min.js"></script>
    <title>ä¸ªäººä¿¡æ¯</title>
</head>
<body>
<div id="root">
    <!--å¤´éƒ¨å¼€å§‹ -->
    <div class="header">
        <div class="return" onclick="location.href='/my.html'"></div>
        <h1 class="self">ä¸ªäººä¿¡æ¯</h1>
        <h1 class="edit" @click="editTurn()" v-show="!editFlag"> ç¼– è¾‘</h1>
        <h1 class="edit" @click="editTurn()" v-show="editFlag"> ä¿ å­˜</h1>
    </div>
    <!-- å¤´éƒ¨ç»“æŸ -->


    <!-- ä¸­é—´éƒ¨åˆ†å¼€å§‹ -->
    <div class="content_continer">

        <!--ä¿¡æ¯ç¼–è¾‘éƒ¨åˆ†-->
        <div class="continer">
            <div class="continer_box">
                <h1 class="hfirst">å¤´åƒ</h1>
                <!-- <div class="touxiang"></div> -->
                <img src="../img/dog.jpg" class="touxiang">
            </div>

            <div class=" continer_box">
                <h1>ID</h1>
                <input type="text" placeholder="è¯·è¾“å…¥" v-model="info.id" disabled="disabled">
            </div>

            <div class="continer_box">
                <h1>æ˜µç§°</h1>
                <input type="text" placeholder="è¯·è¾“å…¥" v-model="info.username" :disabled="!editFlag" maxlength="10">
            </div>

            <div class="continer_box">
                <h1>æ€§åˆ«</h1>
                <div class="choice">
                    ç”·<input type="radio" name="sex" style="zoom:1.5" value="ç”·" v-model="info.sex" :disabled="!editFlag">
                    å¥³<input type="radio" name="sex" style="zoom:1.5" value="å¥³" v-model="info.sex" :disabled="!editFlag">
                    å…¶ä»–<input type="radio" name="sex" style="zoom:1.5" value="å…¶ä»–" v-model="info.sex" :disabled="!editFlag">
                </div>

            </div>


            <div class="continer_box">
                <h1>ç”Ÿæ—¥</h1>
                <input type="date" v-model="getBirth" name="bday" :disabled="!editFlag">
            </div>


            <div class="continer_box">
                <h1>æ‰‹æœº</h1>
                <input type="number" placeholder="è¯·è¾“å…¥" maxlength="11" v-model="info.phoneNum" :disabled="!editFlag">
            </div>

            <div class="continer_box">
                <h1>é‚®ç®±</h1>
                <input type="email" placeholder="è¯·è¾“å…¥" v-model="info.email" :disabled="!editFlag">
            </div>

        </div>

        <!--ä¿®æ”¹å¯†ç -->
        <div class="password">
            <i class="iconfont icon-bianjishuru"></i>
            <h6 class="changepassword" @click="toPasswordModify()">ä¿®æ”¹å¯†ç </h6>
        </div>


    </div>
    <!-- ä¸­é—´éƒ¨åˆ†ç»“æŸ -->

</div>
    <script type="text/javascript">
    Vue.config.productionTip = false;

    const vm = new Vue({
        el: '#root',
        data:{
            editFlag: false,
            birth:{
              year: '',
              month: '',
              day: '',
            },
            info: {
                id: '',
                username: '',
                sex: '',
                birth: '',
                phoneNum: '',
                email: '',
                photoUrl: '',
            },
        },
        created(){
            this.getInfo();
        },
        methods: {
            toPasswordModify() {
                location.href = "/changepassword.html"
            },
            editTurn() {
                if (this.editFlag === false) {
                    this.editFlag = !this.editFlag;
                } else {
                    axios.put("http://localhost/xhk/user/", this.info).then((res) => {
                        if (res.data) {
                            alert('æ“ä½œæˆåŠŸğŸ˜Š');
                            location.reload();
                        } else {
                            alert('æ“ä½œå¤±è´¥â˜¹');
                            location.reload();
                        }
                    })
                }
            },
            getInfo() {
                let xhr = new XMLHttpRequest();
                xhr.open('get', 'http://localhost/xhk/user/' + this.getCookie('curId'));
                xhr.send();
                xhr.onreadystatechange = () => {
                    if (xhr.status === 200 && xhr.readyState === 4) {
                        let parse = JSON.parse(xhr.responseText);
                        this.info.id = parse.id + 777;
                        this.info.username = parse.username;
                        this.info.sex = parse.sex;
                        // this.info.birth = parse.birth;
                        this.birth.year = this.getYear(parse.birth);
                        this.birth.month = this.getMonth(parse.birth);
                        this.birth.day = this.getDay(parse.birth);
                        this.info.phoneNum = parse.phoneNum;
                        this.info.email = parse.email;
                    }
                }
            },
            getYear(birth) {
                if (birth === undefined) {
                    return 'yyyy';
                }
                let date = new Date(birth);
                return date.getFullYear();
            },
            getMonth(birth) {
                if (birth === undefined) {
                    return 'MM';
                }
                let date = new Date(birth);
                return (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1);
            },
            getDay(birth) {
                if (birth === undefined) {
                    return 'dd';
                }
                let date = new Date(birth);
                return date.getDate() < 10 ? '0' + date.getDate() : date.getDate();
            },
            //é€šè¿‡åå­—è·å–cookie
            getCookie(cname) {
                let cookies = document.cookie.split(";");
                let cookName = []
                let cook = [];
                for (let i = 0; i < cookies.length; ++i) {
                    let cookie = cookies[i].split("=");
                    cookName[i] = cookie[0];
                    cook[i] = cookie[1];
                }
                for (let i = 0; i < cookName.length; ++i) {
                    if (cookName[i] === cname) {
                        return cook[i];
                    }
                }
                return '';
            },
        },
        computed:{
            getBirth:{
                get(){
                    return this.birth.year + '-' + this.birth.month + '-' + this.birth.day;
                },
                set(val){
                    this.info.birth = val;
                }
            }
        }
    })
</script>
</body>

</html>